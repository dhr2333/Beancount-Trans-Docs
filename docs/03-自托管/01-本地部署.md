---
tags: []
title: æœ¬åœ°éƒ¨ç½²
slug: deploy
type: Write
date: 2025-08-21
created_time: 2025-08-21 21:39:05
modify_time: 2025-09-12 14:36:01
authors: dhr2333
doc_status: Published
published:
  - beancount-trans-docs
published_time: 2025-09-12 16:07:00
---
æœ¬æ–‡å°†æŒ‡å¯¼æ‚¨å¦‚ä½•åœ¨æ‚¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½² Beancount-Transï¼Œå®ç°æ•°æ®çš„å®Œå…¨ç§æœ‰åŒ–ã€‚

## ä¸€ã€å…ˆå†³æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„éƒ¨ç½²ç›®æ ‡æœºå™¨æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

| é¡¹ç›®                 | è¦æ±‚                                                   | æ£€æŸ¥å‘½ä»¤                     |
| :----------------- | :--------------------------------------------------- | :----------------------- |
| **æ“ä½œç³»ç»Ÿ**           | æ— å¼ºåˆ¶è¦æ±‚ï¼Œä½†å»ºè®®ä½¿ç”¨ä¸»æµçš„ Linux å‘è¡Œç‰ˆï¼ˆå¦‚ Ubuntu 22.04, CentOS 7+ï¼‰  | `cat /etc/os-release`    |
| **Docker**         | å·²å®‰è£… Docker Engineã€‚ç‰ˆæœ¬ â‰¥ 20.10.0ã€‚                      | `docker --version`       |
| **Docker Compose** | å·²å®‰è£… Docker Composeï¼ˆæ’ä»¶æˆ–ç‹¬ç«‹ç‰ˆæœ¬çš†å¯ï¼‰ã€‚ç‰ˆæœ¬ â‰¥ v2.0.0ã€‚           | `docker compose version` |
| **ç¡¬ä»¶èµ„æº**           | å»ºè®®è‡³å°‘ **2 æ ¸ CPUï¼Œ4GB å†…å­˜ï¼Œ20GB å¯ç”¨ç£ç›˜ç©ºé—´**ã€‚                 | `free -h`, `df -h`       |
| **ç½‘ç»œ**             | æœåŠ¡å™¨éœ€èƒ½è®¿é—®äº’è”ç½‘ï¼ˆä»¥ä¸‹è½½ Docker é•œåƒï¼‰ã€‚å¦‚éœ€å¤–éƒ¨è®¿é—®ï¼Œè¯·å¼€æ”¾ç›¸åº”ç«¯å£ï¼ˆå¦‚ `38001`ï¼‰ã€‚ | `ping 8.8.8.8`           |

> **ğŸ’¡ é‡è¦æç¤º**ï¼šåœ¨ Windows å’Œ macOS ä¸Šï¼ŒDocker å®é™…ä¸Šæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè½»é‡çº§çš„ Linux è™šæ‹Ÿæœºä¸­ã€‚å¯¹äº **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Linux æœåŠ¡å™¨**ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚

### å¿…å¤‡ç¯å¢ƒå®‰è£…

å¦‚æœæ‚¨çš„ç³»ç»Ÿå°šæœªå®‰è£… Docker å’Œ Docker Composeï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
# ä»¥ Ubuntu ä¸ºä¾‹ï¼Œä½¿ç”¨å®˜æ–¹è„šæœ¬å¿«é€Ÿå®‰è£… Docker Engine
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£… Docker Compose Plugin (æ¨è)
sudo apt-get update && sudo apt-get install docker-compose-plugin

# éªŒè¯å®‰è£…
docker --version
docker compose version
```

## äºŒã€å¿«é€Ÿå¼€å§‹éƒ¨ç½²

Beancount-Trans ä½¿ç”¨ Docker Compose ç¼–æ’æ‰€æœ‰æœåŠ¡ï¼Œåªéœ€å‡ ä¸ªå‘½ä»¤å³å¯å®Œæˆéƒ¨ç½²ã€‚

### 1. è·å–é¡¹ç›®ä»£ç 

```shell
git clone https://github.com/dhr2333/Beancount-Trans.git
cd Beancount-Trans
git submodule update --init  # åˆå§‹åŒ–æ‰€æœ‰å­æ¨¡å—
```

### 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æ‰€æœ‰å®¹å™¨ï¼š

```shell
# å‰å°å¯åŠ¨ï¼ˆç”¨äºè°ƒè¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼‰
docker compose up

# æˆ–ï¼Œåå°å¯åŠ¨ï¼ˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
docker compose up -d
```

é¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨æ‹‰å–é•œåƒå¹¶åˆ›å»ºæ‰€æœ‰å®¹å™¨ã€ç½‘ç»œå’Œ**ä¸´æ—¶å­˜å‚¨å·**ã€‚

### 3. è®¿é—®æœåŠ¡

å®¹å™¨å¯åŠ¨æˆåŠŸåï¼Œå³å¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®æœåŠ¡ï¼š

- **Beancount-Trans ä¸»ç•Œé¢**ï¼š http://your-server-ip:38001/trans
- **API æ–‡æ¡£**ï¼š http://your-server-ip:38001/api/redoc

> **æ­å–œï¼** è‡³æ­¤ï¼Œä¸€ä¸ªç”¨äºæµ‹è¯•å’Œä½“éªŒçš„åŸºç¡€ç¯å¢ƒå·²ç»éƒ¨ç½²å®Œæˆã€‚**è¯·æ³¨æ„ï¼šæ­¤é»˜è®¤é…ç½®ä½¿ç”¨ä¸´æ—¶å­˜å‚¨å·ï¼Œå®¹å™¨é‡å»ºåæ•°æ®å°†ä¼šä¸¢å¤±ã€‚** å¯¹äºç”Ÿäº§ç”¨é€”ï¼Œè¯·ç»§ç»­é˜…è¯»ä¸‹æ–‡è¿›è¡ŒæŒä¹…åŒ–é…ç½®ã€‚

## ä¸‰ã€ç”Ÿäº§ç¯å¢ƒé…ç½®

ä¸ºäº†è®©æ‚¨çš„æ•°æ®æŒä¹…åŒ–ä¿å­˜ï¼Œæ‚¨éœ€è¦é…ç½®å¤–éƒ¨å­˜å‚¨å·å’Œæ•°æ®åº“å¯†ç ã€‚

### 1. æ•°æ®æŒä¹…åŒ–

1. åˆ›å»ºå¤–éƒ¨å­˜å‚¨å·ï¼š

åœ¨ä½¿ç”¨ `docker compose up` é¦–æ¬¡è¿è¡Œé¡¹ç›®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå¤–éƒ¨å­˜å‚¨å·ã€‚è‹¥ä»¥å­˜åœ¨å¤–éƒ¨å­˜å‚¨å·ï¼Œåˆ™æ— éœ€é‡å¤åˆ›å»ºã€‚

```shell
docker volume create postgres-data
docker volume create redis-data
```

2. ç¼–è¾‘ `docker-compose.yml` æ–‡ä»¶ï¼š

   - æ‰¾åˆ° `volumes` å­˜å‚¨å·éƒ¨åˆ†
   - å–æ¶ˆæ³¨é‡Š `redis` éƒ¨åˆ†ï¼Œå°† `# external: true` ä¿®æ”¹ä¸º `external: true`
   - å¯¹ `postgres` æœåŠ¡æ‰§è¡Œç±»ä¼¼æ“ä½œ

```yaml
# ç¤ºä¾‹ç‰‡æ®µ
volumes:
  redis:
    external: true # è‹¥å·²åˆ›å»ºå¤–éƒ¨å­˜å‚¨å·ï¼Œåˆ™å–æ¶ˆè¯¥æ³¨é‡Š(å¤šæ¬¡docker compose upå¯èƒ½ä¼šå¯¼è‡´å­˜å‚¨å·é‡å¤åˆ›å»ºå¯¼è‡´å¯åŠ¨å¤±è´¥)
    name: redis-data
  postgres:
    external: true # è‹¥å·²åˆ›å»ºå¤–éƒ¨å­˜å‚¨å·ï¼Œåˆ™å–æ¶ˆè¯¥æ³¨é‡Š
    name: postgres-data
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¼ºçƒˆå»ºè®®ä¸ºç”Ÿäº§ç¯å¢ƒä¿®æ”¹é»˜è®¤å¯†ç å’Œå¯†é’¥ã€‚

```yaml
services:
  beancount-trans-backend:
    environment:
      - DJANGO_DEBUG=False
      - DJANGO_SECRET_KEY=django-insecure-agrzd=k49)kyjb8a(2ay(vb9mw#21wtqc!y15g7$x7ctpy00zf
      - TRANS_MYSQL_USER=root
      - TRANS_MYSQL_HOST=postgres
      - TRANS_MYSQL_PORT=5432
      - TRANS_MYSQL_PASSWORD=root
      - TRANS_REDIS_URL=redis://beancount-trans-redis:6379/
      - TRANS_REDIS_PASSWORD=root
  beancount-trans-postgres:
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=root
```

`redis` é…ç½®æ–‡ä»¶

```ini
requirepass root
```

## å››ã€éƒ¨ç½²æµç¨‹ä¸€è§ˆ

æ‚¨å¯ä»¥é€šè¿‡ä¸‹é¢çš„æµç¨‹å›¾å¿«é€Ÿäº†è§£ä»å‡†å¤‡åˆ°éƒ¨ç½²å®Œæ¯•çš„å®Œæ•´è¿‡ç¨‹ï¼š

```mermaid
flowchart TD
A[å¼€å§‹éƒ¨ç½²] --> B[å‡†å¤‡ç¯å¢ƒ: Linux, Docker];
B --> C[è·å–é¡¹ç›®ä»£ç : git clone];
C --> D[å¯é€‰: é…ç½®æŒä¹…åŒ–å­˜å‚¨å·];
D --> E[å¯åŠ¨æœåŠ¡: docker compose up -d];
E --> F{å¯åŠ¨æˆåŠŸ?};
F -- æ˜¯ --> G[è®¿é—®æœåŠ¡<br>http://ip:38001];
F -- å¦ --> H[æŸ¥çœ‹æ—¥å¿—æ’æŸ¥: docker compose logs];
H --> E;
G --> I[éƒ¨ç½²å®Œæˆ];
```

## äº”ã€å¸¸è§æ“ä½œ

### å¯åœæœåŠ¡

```shell
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# é‡å¯ç‰¹å®šæœåŠ¡ï¼ˆå¦‚åç«¯ï¼‰
docker compose restart beancount-trans-backend
```

### æŸ¥çœ‹æ—¥å¿—

æ—¥å¿—æ˜¯æ’æŸ¥é—®é¢˜çš„ç¬¬ä¸€é€‰æ‹©ã€‚

```shell
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å®æ—¶æ—¥å¿—
docker compose logs -f

# ä»…æŸ¥çœ‹åç«¯æœåŠ¡çš„æ—¥å¿—
docker compose logs -f beancount-trans-backend
```

### æ›´æ–°ç‰ˆæœ¬

```shell
# è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ‹‰å–é•œåƒå¹¶å¯åŠ¨å®¹å™¨
docker compose up -d --pull always
```

## å…­ã€æ•…éšœæ’é™¤

- **Q: ç«¯å£å†²çªæ€ä¹ˆåŠï¼Ÿ**
 **A:** ç¼–è¾‘ `docker-compose.yml` æ–‡ä»¶ï¼Œå°†ä¸»æœºç«¯å£ï¼ˆå¦‚ `38001:80`ï¼‰ä¸­çš„ `38001` ä¿®æ”¹ä¸ºå…¶ä»–ç©ºé—²ç«¯å£ã€‚

- **Q: å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ**
 **A:** ä½¿ç”¨ `docker compose logs [service-name]` å‘½ä»¤æŸ¥çœ‹å…·ä½“å®¹å™¨çš„æ—¥å¿—è¾“å‡ºï¼Œé€šå¸¸é”™è¯¯ä¿¡æ¯ä¼šæ˜ç¡®æŒ‡ç¤ºé—®é¢˜æ‰€åœ¨ï¼ˆå¦‚ï¼šå¯†ç é”™è¯¯ã€ç«¯å£å ç”¨ï¼‰ã€‚

- **Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**
 **A:** æ‚¨éœ€è¦å¤‡ä»½å·²é…ç½®çš„æŒä¹…åŒ–å­˜å‚¨å·ï¼ˆå¦‚ `beancount-postgres-data`ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ `docker run --rm -v beancount-postgres-data:/source -v /path/to/backup:/backup alpine tar czf /backup/backup.tar.gz -C /source .` ç­‰å‘½ä»¤è¿›è¡Œå¤‡ä»½ã€‚

---

**ä¸‹ä¸€æ­¥ï¼š**

- éƒ¨ç½²å®Œæˆåï¼Œè¯·å‚é˜… [é…ç½®](https://trans.dhr2333.cn/docs/%E8%87%AA%E6%89%98%E7%AE%A1/config) æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•é…ç½®é‚®ä»¶ã€AI æ¨¡å‹ç­‰é«˜çº§åŠŸèƒ½ã€‚
- æŸ¥é˜… [åå°ç®¡ç†](https://trans.dhr2333.cn/docs/%E8%87%AA%E6%89%98%E7%AE%A1/admin) æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•è¿›è¡Œç”¨æˆ·å’Œç³»ç»Ÿç®¡ç†ã€‚
